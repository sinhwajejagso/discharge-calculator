<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>제대일 계산기 (병역계산 도구)</title>
  <!-- 원래 UI 스타일(사용하신 Tailwind-like 유틸리티를 그대로 유지) -->
  <style>
    /* --- 원본 Tailwind-like 유틸리티 (원래 UI 유지) --- */
    :root { --tw-border-spacing-x: 0; --tw-border-spacing-y: 0; --tw-translate-x: 0; --tw-translate-y: 0; --tw-rotate: 0; --tw-skew-x: 0; --tw-skew-y: 0; --tw-scale-x: 1; --tw-scale-y: 1; --tw-pan-x: ; --tw-pan-y: ; --tw-pinch-zoom: ; --tw-scroll-snap-strictness: proximity; --tw-gradient-from-position: ; --tw-gradient-via-position: ; --tw-gradient-to-position: ; --tw-ordinal: ; --tw-slashed-zero: ; --tw-numeric-figure: ; --tw-numeric-spacing: ; --tw-numeric-fraction: ; --tw-ring-inset: ; --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgb(59 130 246 / 0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; --tw-shadow: 0 0 #0000; --tw-shadow-colored: 0 0 #0000; --tw-blur: ; --tw-brightness: ; --tw-contrast: ; --tw-grayscale: ; --tw-hue-rotate: ; --tw-invert: ; --tw-saturate: ; --tw-sepia: ; --tw-drop-shadow: ; --tw-backdrop-blur: ; --tw-backdrop-brightness: ; --tw-backdrop-contrast: ; --tw-backdrop-grayscale: ; --tw-backdrop-hue-rotate: ; --tw-backdrop-invert: ; --tw-backdrop-opacity: ; --tw-backdrop-saturate: ; --tw-backdrop-sepia: ; }
    *, ::before, ::after { box-sizing: border-box; border-width: 0; border-style: solid; border-color: #e5e7eb; }
    html { line-height: 1.5; -webkit-text-size-adjust: 100%; -moz-tab-size: 4; tab-size: 4; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"; }
    body { margin: 0; line-height: inherit; font-family: 'Noto Sans KR', sans-serif; }
    h1, h3, p, ul { margin: 0; padding: 0; }
    ul { list-style: none; }
    button { background-color: transparent; background-image: none; color: inherit; }
    button:focus:not(:focus-visible) { outline: none; }
    button, select, input { font-family: inherit; font-size: 100%; font-weight: inherit; line-height: inherit; color: inherit; margin: 0; padding: 0; }
    select { text-transform: none; }
    .hidden { display: none; }
    .w-full { width: 100%; }
    .max-w-2xl { max-width: 42rem; }
    .flex { display: flex; }
    .grid { display: grid; }
    .items-center { align-items: center; }
    .items-end { align-items: flex-end; }
    .justify-center { justify-content: center; }
    .justify-between { justify-content: space-between; }
    .gap-4 { gap: 1rem; }
    .space-y-2 > :not([hidden]) ~ :not([hidden]) { --tw-space-y-reverse: 0; margin-top: calc(0.5rem * calc(1 - var(--tw-space-y-reverse))); margin-bottom: calc(0.5rem * var(--tw-space-y-reverse)); }
    .rounded-2xl { border-radius: 1rem; }
    .rounded-full { border-radius: 9999px; }
    .rounded-lg { border-radius: 0.5rem; }
    .rounded-md { border-radius: 0.375rem; }
    .border { border-width: 1px; }
    .border-b { border-bottom-width: 1px; }
    .border-blue-200 { --tw-border-opacity: 1; border-color: rgb(191 219 254 / var(--tw-border-opacity)); }
    .border-green-200 { --tw-border-opacity: 1; border-color: rgb(187 247 208 / var(--tw-border-opacity)); }
    .border-red-200 { --tw-border-opacity: 1; border-color: rgb(254 202 202 / var(--tw-border-opacity)); }
    .border-gray-300 { --tw-border-opacity: 1; border-color: rgb(209 213 219 / var(--tw-border-opacity)); }
    .bg-white { --tw-bg-opacity: 1; background-color: rgb(255 255 255 / var(--tw-bg-opacity)); }
    .bg-gray-100 { --tw-bg-opacity: 1; background-color: rgb(243 244 246 / var(--tw-bg-opacity)); }
    .bg-gray-50 { --tw-bg-opacity: 1; background-color: rgb(249 250 251 / var(--tw-bg-opacity)); }
    .bg-gray-200 { --tw-bg-opacity: 1; background-color: rgb(229 231 235 / var(--tw-bg-opacity)); }
    .bg-indigo-600 { --tw-bg-opacity: 1; background-color: rgb(79 70 229 / var(--tw-bg-opacity)); }
    .hover\:bg-indigo-700:hover { --tw-bg-opacity: 1; background-color: rgb(67 56 202 / var(--tw-bg-opacity)); }
    .bg-blue-50 { --tw-bg-opacity: 1; background-color: rgb(239 246 255 / var(--tw-bg-opacity)); }
    .bg-green-50 { --tw-bg-opacity: 1; background-color: rgb(240 253 244 / var(--tw-bg-opacity)); }
    .bg-red-50 { --tw-bg-opacity: 1; background-color: rgb(254 242 242 / var(--tw-bg-opacity)); }
    .p-2 { padding: 0.5rem; }
    .p-4 { padding: 1rem; }
    .p-6 { padding: 1.5rem; }
    .pb-2 { padding-bottom: 0.5rem; }
    .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
    .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
    .py-2\.5 { padding-top: 0.625rem; padding-bottom: 0.625rem; }
    .px-4 { padding-left: 1rem; padding-right: 1rem; }
    .text-center { text-align: center; }
    .font-bold { font-weight: 700; }
    .font-medium { font-weight: 500; }
    .font-semibold { font-weight: 600; }
    .h-4 { height: 1rem; }
    .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
    .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
    .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
    .text-2xl { font-size: 1.5rem; line-height: 2rem; }
    .text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
    .text-white { --tw-text-opacity: 1; color: rgb(255 255 255 / var(--tw-text-opacity)); }
    .text-gray-500 { --tw-text-opacity: 1; color: rgb(107 114 128 / var(--tw-text-opacity)); }
    .text-gray-700 { --tw-text-opacity: 1; color: rgb(55 65 81 / var(--tw-text-opacity)); }
    .text-gray-800 { --tw-text-opacity: 1; color: rgb(31 41 55 / var(--tw-text-opacity)); }
    .text-indigo-600 { --tw-text-opacity: 1; color: rgb(79 70 229 / var(--tw-text-opacity)); }
    .text-indigo-700 { --tw-text-opacity: 1; color: rgb(67 56 202 / var(--tw-text-opacity)); }
    .text-red-500 { --tw-text-opacity: 1; color: rgb(239 68 68 / var(--tw-text-opacity)); }
    .text-red-600 { --tw-text-opacity: 1; color: rgb(220 38 38 / var(--tw-text-opacity)); }
    .text-red-800 { --tw-text-opacity: 1; color: rgb(153 27 27 / var(--tw-text-opacity)); }
    .text-blue-800 { --tw-text-opacity: 1; color: rgb(30 64 175 / var(--tw-text-opacity)); }
    .text-blue-900 { --tw-text-opacity: 1; color: rgb(30 58 138 / var(--tw-text-opacity)); }
    .text-green-800 { --tw-text-opacity: 1; color: rgb(22 101 52 / var(--tw-text-opacity)); }
    .text-green-900 { --tw-text-opacity: 1; color: rgb(20 83 45 / var(--tw-text-opacity)); }
    .shadow-lg { --tw-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); --tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow); }
    .shadow-sm { --tw-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); --tw-shadow-colored: 0 1px 2px 0 var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow); }
    .transition-all { transition-property: all; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
    .duration-150 { transition-duration: 150ms; }
    .duration-500 { transition-duration: 500ms; }
    .ease-in-out { transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); }
    .focus\:outline-none:focus { outline: 2px solid transparent; outline-offset: 2px; }
    .focus\:ring-2:focus { --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color); --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color); box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000); }
    .focus\:ring-offset-2:focus { --tw-ring-offset-width: 2px; }
    .focus\:border-indigo-500:focus { --tw-border-opacity: 1; border-color: rgb(99 102 241 / var(--tw-border-opacity)); }
    .focus\:ring-indigo-500:focus { --tw-ring-color: rgb(99 102 241 / var(--tw-ring-opacity)); --tw-ring-opacity: 1; }
    .min-h-screen { min-height: 100vh; }
    .mx-auto { margin-left: auto; margin-right: auto; }
    .mb-1 { margin-bottom: 0.25rem; }
    .mb-3 { margin-bottom: 0.75rem; }
    .mb-6 { margin-bottom: 1.5rem; }
    .mb-8 { margin-bottom: 2rem; }
    .mb-16 { margin-bottom: 4rem; }
    .mt-2 { margin-top: 0.5rem; }
    @media (min-width: 640px) { .sm\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); } }
    @media (min-width: 768px) { .md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); } .md\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); } .md\:p-8 { padding: 2rem; } .md\:text-4xl { font-size: 2.25rem; line-height: 2.5rem; } }
    input[type="date"]:not(:valid):in-range::-webkit-datetime-edit { color: #9ca3af; }
  </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
  <div class="w-full max-w-2xl mx-auto p-6 md:p-8 bg-white rounded-2xl shadow-lg mb-16">
    <div class="text-center mb-8">
      <h1 class="text-3xl md:text-4xl font-bold text-gray-800">제대일 계산기</h1>
      <p class="text-gray-500 mt-2">입대일을 입력하면 제대일과 남은 일수를 계산해드립니다!</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 items-end">
      <div>
        <label for="enlistment-date" class="block text-sm font-medium text-gray-700 mb-1">입대일</label>
        <input type="date" id="enlistment-date" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 focus:border-indigo-500" required>
      </div>

      <div>
        <label for="service-branch" class="block text-sm font-medium text-gray-700 mb-1">병과</label>
        <select id="service-branch" class="w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 focus:border-indigo-500">
          <option value="army">육군</option>
          <option value="navy">해군</option>
          <option value="airforce">공군</option>
          <option value="marines">해병대</option>
        </select>
      </div>

      <button id="calculate-btn" type="button" class="w-full bg-indigo-600 text-white font-bold py-2.5 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-150 ease-in-out">제대일 계산</button>
    </div>

    <div id="error-message" class="text-center text-red-500 mb-6 hidden font-medium" role="alert" aria-live="assertive"></div>

    <div id="results-section" class="hidden">
      <div class="mb-6">
        <div class="flex justify-between mb-1">
          <span class="text-base font-medium text-indigo-700">진행도</span>
          <span id="progress-percentage" class="text-sm font-medium text-indigo-700">0%</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-4">
          <div id="progress-bar" class="bg-indigo-600 h-4 rounded-full transition-all duration-500" style="width: 0%"></div>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-center mb-6">
        <div class="bg-gray-50 p-4 rounded-lg"><p class="text-sm text-gray-500">제대일</p><p id="discharge-date" class="text-2xl font-bold text-gray-800">-</p></div>
        <div class="bg-gray-50 p-4 rounded-lg"><p class="text-sm text-gray-500">총 남은 일수</p><p id="total-remaining-days" class="text-2xl font-bold text-indigo-600">-</p></div>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-center mb-8">
        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200"><p class="text-sm font-medium text-blue-800">남은 평일</p><p id="remaining-weekdays" class="text-xl font-bold text-blue-900">- 일</p></div>
        <div class="bg-green-50 p-4 rounded-lg border border-green-200"><p class="text-sm font-medium text-green-800">남은 주말</p><p id="remaining-weekends" class="text-xl font-bold text-green-900">- 일</p></div>
        <div class="bg-red-50 p-4 rounded-lg border border-red-200"><p class="text-sm font-medium text-red-800">남은 공휴일</p><p id="remaining-holidays" class="text-xl font-bold text-red-900">- 일</p></div>
      </div>

      <div id="upcoming-holidays-container" class="hidden">
        <h3 class="text-lg font-semibold text-gray-700 mb-3 border-b pb-2">남은 공휴일 일정</h3>
        <ul id="upcoming-holidays-list" class="space-y-2"></ul>
      </div>
    </div>
  </div>

  <script>
    // UI는 원래대로 유지하면서 로직(날짜 계산, 오프바이원, 타임존 이슈 등)을 개선한 스크립트입니다.
    document.addEventListener('DOMContentLoaded', () => {
      const enlistmentDateEl = document.getElementById('enlistment-date');
      const serviceBranchEl = document.getElementById('service-branch');
      const calculateBtn = document.getElementById('calculate-btn');
      const errorMessageEl = document.getElementById('error-message');
      const resultsSection = document.getElementById('results-section');
      const progressBar = document.getElementById('progress-bar');
      const progressPercentage = document.getElementById('progress-percentage');
      const dischargeDateEl = document.getElementById('discharge-date');
      const totalRemainingDaysEl = document.getElementById('total-remaining-days');
      const remainingWeekdaysEl = document.getElementById('remaining-weekdays');
      const remainingWeekendsEl = document.getElementById('remaining-weekends');
      const remainingHolidaysEl = document.getElementById('remaining-holidays');
      const upcomingHolidaysContainer = document.getElementById('upcoming-holidays-container');
      const upcomingHolidaysList = document.getElementById('upcoming-holidays-list');

      // 기본값: 오늘 날짜로 설정 (타임존 영향 최소화)
      const setTodayAsDefault = () => {
        const t = new Date();
        t.setHours(0,0,0,0);
        enlistmentDateEl.value = t.toISOString().split('T')[0];
      };
      setTodayAsDefault();

      const SERVICE_MONTHS = { army: 18, navy: 20, airforce: 21, marines: 18 };

      // 원래 사용하신 공휴일 맵을 그대로 둡니다.
      const KOREAN_HOLIDAYS = new Map([
        ['2024-08-15', '광복절'], ['2024-09-16', '추석 연휴'], ['2024-09-17', '추석'], ['2024-09-18', '추석 연휴'], ['2024-10-03', '개천절'], ['2024-10-09', '한글날'], ['2024-12-25', '크리스마스'],
        ['2025-01-01', '신정'], ['2025-01-28', '설날 연휴'], ['2025-01-29', '설날'], ['2025-01-30', '설날 연휴'], ['2025-03-01', '3.1절'], ['2025-05-01', '근로자의 날'], ['2025-05-05', '어린이날'], ['2025-05-06', '대체공휴일'], ['2025-06-06', '현충일'], ['2025-08-15', '광복절'], ['2025-10-03', '개천절'], ['2025-10-06', '추석'], ['2025-10-07', '추석 연휴'], ['2025-10-08', '대체공휴일(추석)'], ['2025-10-09', '한글날'], ['2025-12-25', '크리스마스'],
        ['2026-01-01', '신정'], ['2026-02-16', '설날 연휴'], ['2026-02-17', '설날'], ['2026-02-18', '설날 연휴'], ['2026-03-01', '3.1절'], ['2026-03-02', '대체공휴일(3.1절)'], ['2026-05-01', '근로자의 날'], ['2026-05-05', '어린이날'], ['2026-05-25', '대체공휴일'], ['2026-06-06', '현충일'], ['2026-08-15', '광복절'], ['2026-09-24', '추석 연휴'], ['2026-09-25', '추석'], ['2026-09-26', '추석 연휴'], ['2026-10-03', '개천절'], ['2026-10-09', '한글날'], ['2026-12-25', '크리스마스']
      ]);

      const msPerDay = 1000 * 60 * 60 * 24;
      const formatDate = (date) => date.toISOString().split('T')[0];

      calculateBtn.addEventListener('click', () => {
        const enlistmentDateStr = enlistmentDateEl.value;
        if (!enlistmentDateStr) {
          errorMessageEl.textContent = '입대일을 선택해 주세요.';
          errorMessageEl.classList.remove('hidden');
          resultsSection.classList.add('hidden');
          return;
        }
        errorMessageEl.classList.add('hidden');

        const enlistmentDate = new Date(enlistmentDateStr + 'T00:00:00');
        enlistmentDate.setHours(0,0,0,0);

        // 제대일 계산: 서비스 개월 수 더하고 마지막 날을 포함하도록 -1일 처리
        const dischargeDate = new Date(enlistmentDate);
        dischargeDate.setMonth(dischargeDate.getMonth() + SERVICE_MONTHS[serviceBranchEl.value]);
        dischargeDate.setDate(dischargeDate.getDate() - 1);
        dischargeDate.setHours(0,0,0,0);

        const today = new Date();
        today.setHours(0,0,0,0);

        if (today > dischargeDate) {
          errorMessageEl.textContent = '이미 제대한 날짜입니다.';
          errorMessageEl.classList.remove('hidden');
          resultsSection.classList.add('hidden');
          return;
        }

        // 날짜 계산을 ms 단위로 안정적으로 수행 (오프바이원 보정)
        const totalServiceDays = Math.floor((dischargeDate - enlistmentDate) / msPerDay) + 1;
        const daysServed = Math.max(0, Math.floor((today - enlistmentDate) / msPerDay) + 1);
        const progress = Math.max(0, Math.min(100, (daysServed / totalServiceDays) * 100));
        const totalRemainingDays = Math.max(0, Math.ceil((dischargeDate - today) / msPerDay));

        let remainingWeekdays = 0, remainingWeekends = 0, remainingHolidays = 0;
        let holidaysDetailList = [];
        let currentDate = new Date(today);

        // 남은 기간(오늘 포함)에서 평일/주말/공휴일 집계
        while (currentDate <= dischargeDate) {
          const dayOfWeek = currentDate.getDay();
          const formattedDate = formatDate(currentDate);

          if (KOREAN_HOLIDAYS.has(formattedDate)) {
            remainingHolidays++;
            holidaysDetailList.push({ date: formattedDate, name: KOREAN_HOLIDAYS.get(formattedDate) });
          } else if (dayOfWeek === 0 || dayOfWeek === 6) {
            remainingWeekends++;
          } else {
            remainingWeekdays++;
          }
          currentDate.setDate(currentDate.getDate() + 1);
        }

        // 결과 반영 (UI는 원래대로)
        progressBar.style.width = `${progress.toFixed(2)}%`;
        progressPercentage.textContent = `${progress.toFixed(2)}%`;
        dischargeDateEl.textContent = formatDate(dischargeDate);
        totalRemainingDaysEl.textContent = totalRemainingDays;
        remainingWeekdaysEl.textContent = `${remainingWeekdays} 일`;
        remainingWeekendsEl.textContent = `${remainingWeekends} 일`;
        remainingHolidaysEl.textContent = `${remainingHolidays} 일`;

        upcomingHolidaysList.innerHTML = '';
        if (holidaysDetailList.length > 0) {
          holidaysDetailList.forEach(holiday => {
            const li = document.createElement('li');
            li.className = 'flex justify-between items-center bg-red-50 p-2 rounded-md';
            li.innerHTML = `<span class="font-medium text-red-800">${holiday.name}</span><span class="text-sm text-red-600">${holiday.date}</span>`;
            upcomingHolidaysList.appendChild(li);
          });
          upcomingHolidaysContainer.classList.remove('hidden');
        } else {
          upcomingHolidaysContainer.classList.add('hidden');
        }

        resultsSection.classList.remove('hidden');
      });
    });
  </script>
</body>
</html>